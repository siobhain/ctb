{% extends "base.html" %}

{% block head_title %}Member Full{% endblock %}

{% block content %}
<div class="container-fluid pt-3">
    <div class="row">
        <div class="col-md-8 offset-md-2 text-center topbox">
            <h2>The Full Published Task Board</h2>
            <h5>
                {% if  task_length|length > 2 %} 
                    There are <strong>{{ tasks|length }}</strong> tasks altogether<br>
                {%endif%}
            </h5>
            <a href="/" class="btn btn-primary">Home</a>
            <a href="/todo" class="btn btn-primary">{{ user.profile.firstname|capfirst }}'s Todo Board</a>
            <br>
        </div>
    </div>
</div>    
<div class="table-responsive">
    <table class="table table-striped table-condensed"> 
        <thead>
            <tr>
                <th>Date</th>
                <th>Created By</th>
                <th>Done</th>
                <th>Task Description</th>
                <th>Category</th>
            </tr>
        </thead>
        <tbody>
            {% for task in task_list %}
            <tr>
                <td> {{ task.created_on|date:"d M" }} </td>
                <td>{% if task.created_by == user %}
                        YOURS
                    {% else %}
                        {{ task.created_by.profile.firstname|capfirst }}
                        {{ task.created_by.profile.surname|capfirst }}
                    {% endif %}
                </td>
                <td> {% if task.completed %}
                        YES
                    {% else %}
                        NO
                    {% endif %}
                </td>
                <td> {{ task|capfirst }} </td>
                <td> {{ task.get_category_display }} </td>
            </tr>
            {% empty %}
                <td> {% now "d M" %} </td>
                <td> - </td>
                <td> - </td>
                <td> {{ user.profile.firstname|capfirst }}, Do you need to
                    <a href="/create" class="btn btn-primary">Add a New Task</a>
                </td> 
                <td> - </td>
            {% endfor %}
        </tbody>    
    </table>
</div>
{%endblock%}
{% block extrabody %}

<!-- From https://stackoverflow.com/questions/70216027/change-table-row-background-color-based-on-td-content -->

<script>
const CompletedCells = document.querySelectorAll('td:nth-child(4)');

rows.forEach((row) => {
  if (row.innerHTML === 'COMPLETED') {
    const parent = row.parentNode;
    parent.style.backgroundColor = 'green';
  }
});
</script>
{% endblock %}